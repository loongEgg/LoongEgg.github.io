{"meta":{"title":"Loong Egg","subtitle":"","description":"一个强大的蓝人","author":"Loong Egg","url":"https://LoongEgg.github.io","root":"/"},"pages":[{"title":"All Categories","date":"2020-06-13T04:28:29.000Z","updated":"2020-06-13T04:30:49.410Z","comments":true,"path":"categories/index.html","permalink":"https://loongegg.github.io/categories/index.html","excerpt":"","text":""},{"title":"about","date":"2020-06-13T04:44:20.000Z","updated":"2020-06-13T10:15:55.781Z","comments":true,"path":"about/index.html","permalink":"https://loongegg.github.io/about/index.html","excerpt":"","text":"一个强大的蓝人地精工程学毕业，开源软件开发与布道者 专精 程序开发 WPF/C#、MVVM设计模式 UI、Font设计 Inkscape、Fontforge 三维建模 FreeCAD 视频剪辑 Blender、Olive PCB软硬件设计 KiCAD、CubeIDE 以上专业名词的拼写 联系我 Email loongegg@163.com 知乎主页 https://www.zhihu.com/people/inner-geek bilibi主页 https://space.bilibili.com/14343016 微信公众号 香辣恐龙蛋 github https://github.com/loongEgg"},{"title":"All Tags","date":"2020-06-13T04:23:21.000Z","updated":"2020-06-13T04:26:11.891Z","comments":true,"path":"tags/index.html","permalink":"https://loongegg.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"C#/Udp-5.ViewModel中发送功能的实现","slug":"C-Udp-5-ViewModel中发送功能的实现","date":"2020-06-13T11:28:15.000Z","updated":"2020-06-13T12:01:52.121Z","comments":true,"path":"2020/06/13/C-Udp-5-ViewModel中发送功能的实现/","link":"","permalink":"https://loongegg.github.io/2020/06/13/C-Udp-5-ViewModel%E4%B8%AD%E5%8F%91%E9%80%81%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E7%8E%B0/","excerpt":"","text":"摘要 在ViewModel中利用属性改变事件发起Udp通信前言1.系列主题本系列文章，旨在实现使用Json进行配置的Udp收发器 An Udp Sender &amp; Receiver using json file to configure 2.目标框架(target framework) .net framework 4.5 to support using in windows with .net framework &gt;= 4.5 .net standard 2.0 to support using in linux with .net core &gt;= 2.0 3.项目依赖（Dependency） LoongEgg.DependencyInjection IoC container , you can get it from nuget or my github LoongEgg.MvvmCore an OpenSource cross-platform &amp; cross-framework Mvvm lib , you can get it from nuget or my github LoongEgg.LoongLog an OpenSource cross-platform &amp; cross-framework log tool, you can get it from nuget or my github Newtonsoft.Json 4.项目地址(Source code) github 5.发行版获取 Search in nuget: LoongEgg.UdpCore 在ViewModel中增加属性改变处理事件 AltPackViewModel.cs12345678910111213141516171819202122readonly UdpSender Sender;/// &lt;summary&gt;/// 会启动Udp发送器的实例，默认采用组播模式，只需设置端口号一致即可接收到/// &lt;/summary&gt;/// &lt;param name=\"config\"&gt;json配置实例&lt;/param&gt;/// &lt;param name=\"port\"&gt;端口号&lt;/param&gt;public AltPackViewModel(JsonPackConfig config, int port) : this(config)&#123; Gps.PropertyChanged += OnPropertyChanged; Sender = new UdpSender(port, true);&#125;/// &lt;summary&gt;/// 当属性改变时，调用Udp发送功能/// &lt;/summary&gt; private void OnPropertyChanged(object sender, PropertyChangedEventArgs e)&#123; if (e.PropertyName == nameof(AltViewModel.Readout)) &#123; Sender?.SendAsync($\"Gps=&#123;Gps.Readout&#125;\"); &#125;&#125; 更改程序启动代码 App.xaml.cs1234567891011121314151617181920212223242526272829using LoongEgg.DependencyInjection;using LoongEgg.LoongLog;using LoongEgg.UdpCore;using System;using System.Windows;namespace UdpJsonSender.WPF&#123; /// &lt;summary&gt; /// App.xaml 的交互逻辑 /// &lt;/summary&gt; public partial class App : Application &#123; protected override void OnStartup(StartupEventArgs e) &#123; base.OnStartup(e); IoC = new Container(); Logger.EnableDebugLogger(); var config = JsonPackConfig.DeserializeFromFile(AppDomain.CurrentDomain.BaseDirectory + \"AltPack.json\"); IoC.AddOrUpdate(new AltPackViewModel( config, 2233)); // 端口号与接收器一致 &#125; /// &lt;summary&gt; /// 依赖注入容器 /// &lt;/summary&gt; public Container IoC &#123; get; set; &#125; &#125;&#125; 运行测试（注意，如果使用了LoongEgg.LoongLogger可以在输出中跟踪程序运行情况）1.启动WPF程序2.启动前面创建的接受客户端3.拖动GPS的Slider条检查程序运行情况","categories":[{"name":"C#/UDP","slug":"C-UDP","permalink":"https://loongegg.github.io/categories/C-UDP/"}],"tags":[{"name":"C#","slug":"C","permalink":"https://loongegg.github.io/tags/C/"},{"name":"json","slug":"json","permalink":"https://loongegg.github.io/tags/json/"},{"name":"MVVM","slug":"MVVM","permalink":"https://loongegg.github.io/tags/MVVM/"}]},{"title":"C#/Udp-4.WPF发送端界面设计","slug":"C-Udp-4-WPF发送端界面设计","date":"2020-06-13T06:13:17.000Z","updated":"2020-06-13T11:30:54.514Z","comments":true,"path":"2020/06/13/C-Udp-4-WPF发送端界面设计/","link":"","permalink":"https://loongegg.github.io/2020/06/13/C-Udp-4-WPF%E5%8F%91%E9%80%81%E7%AB%AF%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A1/","excerpt":"","text":"摘要 创建WPF/C#的UdpSender客户端，并使用MVVM模式完成Name和Unit的绑定前言1.系列主题本系列文章，旨在实现使用Json进行配置的Udp收发器 An Udp Sender &amp; Receiver using json file to configure 2.目标框架(target framework) .net framework 4.5 to support using in windows with .net framework &gt;= 4.5 .net standard 2.0 to support using in linux with .net core &gt;= 2.0 3.项目依赖（Dependency） LoongEgg.DependencyInjection IoC container , you can get it from nuget or my github LoongEgg.MvvmCore an OpenSource cross-platform &amp; cross-framework Mvvm lib , you can get it from nuget or my github LoongEgg.LoongLog an OpenSource cross-platform &amp; cross-framework log tool, you can get it from nuget or my github Newtonsoft.Json 4.项目地址(Source code) github 5.发行版获取 Search in nuget: LoongEgg.UdpCore ViewModels123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051using LoongEgg.MvvmCore;/* | 个人微信：InnerGeeker | 联系邮箱：LoongEgg@163.com | 创建时间：2020/6/13 17:00:07 | 主要用途： | 更改记录： | 时间 版本 更改 */namespace UdpJsonSender.WPF&#123; public class AltViewModel : ViewModel &#123; public string Name &#123; get &#123; return _Name; &#125; set &#123; SetProperty(ref _Name, value); &#125; &#125; private string _Name; public string Unit &#123; get &#123; return _Unit; &#125; set &#123; SetProperty(ref _Unit, value); &#125; &#125; private string _Unit; public double Maximum &#123; get &#123; return _Maximum; &#125; set &#123; SetProperty(ref _Maximum, value); &#125; &#125; private double _Maximum; public double Minimum &#123; get &#123; return _Minimum; &#125; set &#123; SetProperty(ref _Minimum, value); &#125; &#125; private double _Minimum; public double Readout &#123; get &#123; return _Readout; &#125; set &#123; SetProperty(ref _Readout, value); &#125; &#125; private double _Readout; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061using LoongEgg.MvvmCore;using LoongEgg.UdpCore;/* | 个人微信：InnerGeeker | 联系邮箱：LoongEgg@163.com | 创建时间：2020/6/13 17:11:16 | 主要用途： | 更改记录： | 时间 版本 更改 */namespace UdpJsonSender.WPF&#123; public class AltPackViewModel : ViewModel &#123; internal static AltPackViewModel DesignInstance &#123; get; &#125; = new AltPackViewModel( JsonPackConfig.DeserializeFromFile( @\"E:\\Published\\LoongEgg.UdpCore\\UdpJsonSender.WPF\\AltPack.json\")); // 根据你自己实际的文件路径写 public string PackName &#123; get &#123; return _PackName; &#125; set &#123; SetProperty(ref _PackName, value); &#125; &#125; private string _PackName; public byte PackId &#123; get &#123; return _PackId; &#125; set &#123; SetProperty(ref _PackId, value); &#125; &#125; private byte _PackId; public AltViewModel Gps &#123; get; set; &#125; public AltViewModel Baro &#123; get; set; &#125; public AltPackViewModel(JsonPackConfig config) &#123; Gps = new AltViewModel &#123; Name = config.Items[0].Name, Unit = config.Items[0].Unit, Minimum = config.Items[0].Minimum, Maximum = config.Items[0].Maximum &#125;; Baro = new AltViewModel &#123; Name = config.Items[1].Name, Unit = config.Items[1].Unit, Minimum = config.Items[1].Minimum, Maximum = config.Items[1].Maximum &#125;; PackName = config.PackName; PackId = config.PackID; &#125; &#125;&#125; App启动设置1234567891011121314151617181920212223242526using LoongEgg.DependencyInjection;using LoongEgg.UdpCore;using System;using System.Windows;namespace UdpJsonSender.WPF&#123; /// &lt;summary&gt; /// App.xaml 的交互逻辑 /// &lt;/summary&gt; public partial class App : Application &#123; protected override void OnStartup(StartupEventArgs e) &#123; base.OnStartup(e); IoC = new Container(); IoC.AddOrUpdate(new AltPackViewModel( JsonPackConfig.DeserializeFromFile(AppDomain.CurrentDomain.BaseDirectory + \"AltPack.json\"))); &#125; /// &lt;summary&gt; /// 依赖注入容器 /// &lt;/summary&gt; public Container IoC &#123; get; set; &#125; &#125;&#125; 前台绑定注意用来提供语法提示的设计时绑定 d:DataContext=&quot;{x:Static local:AltPackViewModel.DesignInstance}&quot; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768&lt;Window x:Class=\"UdpJsonSender.WPF.MainWindow\" xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\" xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\" xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\" xmlns:local=\"clr-namespace:UdpJsonSender.WPF\" xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\" Title=\"MainWindow\" Width=\"600\" Height=\"300\" d:DataContext=\"&#123;x:Static local:AltPackViewModel.DesignInstance&#125;\" FontSize=\"26\" Foreground=\"Black\" mc:Ignorable=\"d\"&gt; &lt;Grid&gt; &lt;Grid.RowDefinitions&gt; &lt;RowDefinition /&gt; &lt;RowDefinition /&gt; &lt;/Grid.RowDefinitions&gt; &lt;StackPanel Grid.Row=\"0\" HorizontalAlignment=\"Center\" VerticalAlignment=\"Center\" Orientation=\"Horizontal\"&gt; &lt;TextBlock&gt; &lt;Run&gt;PackName:&lt;/Run&gt; &lt;Run Text=\"&#123;Binding PackName&#125;\" /&gt; &lt;Run&gt;, PackID:&lt;/Run&gt; &lt;Run Text=\"&#123;Binding PackId&#125;\" /&gt; &lt;/TextBlock&gt; &lt;/StackPanel&gt; &lt;ListBox Grid.Row=\"1\"&gt; &lt;ListBoxItem VerticalAlignment=\"Center\"&gt; &lt;StackPanel DataContext=\"&#123;Binding Gps&#125;\" Orientation=\"Horizontal\"&gt; &lt;TextBlock Width=\"250\"&gt; &lt;Run Text=\"&#123;Binding Name&#125;\" /&gt; &lt;Run Text=\"&#123;Binding Readout, StringFormat=&#123;&#125;&#123;0:f1&#125;&#125;\" /&gt; &lt;Run Text=\"&#123;Binding Unit, StringFormat=(&#123;0&#125;)&#125;\" /&gt; &lt;/TextBlock&gt; &lt;Slider Width=\"300\" VerticalAlignment=\"Center\" Maximum=\"&#123;Binding Maximum&#125;\" Minimum=\"&#123;Binding Minimum&#125;\" Orientation=\"Horizontal\" Value=\"&#123;Binding Readout&#125;\" /&gt; &lt;/StackPanel&gt; &lt;/ListBoxItem&gt; &lt;ListBoxItem VerticalAlignment=\"Center\"&gt; &lt;StackPanel DataContext=\"&#123;Binding Baro&#125;\" Orientation=\"Horizontal\"&gt; &lt;TextBlock Width=\"250\"&gt; &lt;Run Text=\"&#123;Binding Name&#125;\" /&gt; &lt;Run Text=\"&#123;Binding Readout, StringFormat=&#123;&#125;&#123;0:f1&#125;&#125;\" /&gt; &lt;Run Text=\"&#123;Binding Unit, StringFormat=(&#123;0&#125;)&#125;\" /&gt; &lt;/TextBlock&gt; &lt;Slider Width=\"300\" VerticalAlignment=\"Center\" Maximum=\"&#123;Binding Maximum&#125;\" Minimum=\"&#123;Binding Minimum&#125;\" Orientation=\"Horizontal\" Value=\"&#123;Binding Readout&#125;\" /&gt; &lt;/StackPanel&gt; &lt;/ListBoxItem&gt; &lt;/ListBox&gt; &lt;/Grid&gt;&lt;/Window&gt; DataContext后台设置12345678910111213141516using System.Windows;namespace UdpJsonSender.WPF&#123; /// &lt;summary&gt; /// MainWindow.xaml 的交互逻辑 /// &lt;/summary&gt; public partial class MainWindow : Window &#123; public MainWindow() &#123; InitializeComponent(); DataContext = (Application.Current as App).IoC.Get&lt;AltPackViewModel&gt;(); &#125; &#125;&#125;","categories":[{"name":"C#/UDP","slug":"C-UDP","permalink":"https://loongegg.github.io/categories/C-UDP/"}],"tags":[{"name":"C#","slug":"C","permalink":"https://loongegg.github.io/tags/C/"},{"name":"json","slug":"json","permalink":"https://loongegg.github.io/tags/json/"},{"name":"WPF","slug":"WPF","permalink":"https://loongegg.github.io/tags/WPF/"},{"name":"MVVM","slug":"MVVM","permalink":"https://loongegg.github.io/tags/MVVM/"}]},{"title":"C#/Udp-3.class类到json的序列化与反序列化","slug":"C-Udp-3-class类到json的序列化与反序列化","date":"2020-06-13T05:46:21.000Z","updated":"2020-06-13T11:30:52.677Z","comments":true,"path":"2020/06/13/C-Udp-3-class类到json的序列化与反序列化/","link":"","permalink":"https://loongegg.github.io/2020/06/13/C-Udp-3-class%E7%B1%BB%E5%88%B0json%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"","text":"摘要class类到json的序列化与反序列化前言1.系列主题本系列文章，旨在实现使用Json进行配置的Udp收发器 An Udp Sender &amp; Receiver using json file to configure 2.目标框架(target framework) .net framework 4.5 to support using in windows with .net framework &gt;= 4.5 .net standard 2.0 to support using in linux with .net core &gt;= 2.0 3.项目依赖（Dependency） LoongEgg.LoongLog an OpenSource cross-platform &amp; cross-framework log tool, you can get it from nuget or my github Newtonsoft.Json 4.项目地址(Source code) github 5.发行版获取 Search in nuget: LoongEgg.UdpCore 基本json文件1234567891011121314151617181920212223242526&#123; \"PackName\": \"AltitudePack\", \"PackID\": 233, \"Items\": [ &#123; \"Name\": \"GPS_Alt\", \"Unit\": \"m\", \"Length\": 2, \"BigEndian\": false, \"Resolution\": 1.0, \"Signed\": true, \"Maximum\": 100, \"Minimum\": -100 &#125;, &#123; \"Name\": \"BRAVO_Alt\", \"Unit\": \"m\", \"Length\": 2, \"BigEndian\": false, \"Resolution\": 0.5, \"Signed\": false, \"Maximum\": 100, \"Minimum\": -100 &#125; ]&#125; 单个数据项定义12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667/* | 个人微信：InnerGeeker | 联系邮箱：LoongEgg@163.com | 创建时间：2020/6/12 20:24:28 | 主要用途：数据包中单个数据项的定义 | 更改记录： | 时间 版本 更改 */namespace LoongEgg.UdpCore&#123; /// &lt;summary&gt; /// 单个数据项定义 /// &lt;/summary&gt; public class ItemConfig &#123; /// &lt;summary&gt; /// 数据名称 /// &lt;/summary&gt; public string Name &#123; get; set; &#125; /// &lt;summary&gt; /// 单位 /// &lt;/summary&gt; public string Unit &#123; get; set; &#125; /// &lt;summary&gt; /// 字节长度 /// &lt;/summary&gt; public int Length &#123; get; set; &#125; /// &lt;summary&gt; /// 大端在前？ /// &lt;/summary&gt; public bool BigEndian &#123; get; set; &#125; /// &lt;summary&gt; /// 数据精度，精度乘以传进来的数据=实际的数值 /// &lt;/summary&gt; public float Resolution &#123; get; set; &#125; /// &lt;summary&gt; /// 有无符号？ /// &lt;/summary&gt; public bool Signed &#123; get; set; &#125; /// &lt;summary&gt; /// 数据的最大值 /// &lt;/summary&gt; public float Maximum &#123; get; set; &#125; /// &lt;summary&gt; /// 数据的最小值 /// &lt;/summary&gt; public float Minimum &#123; get; set; &#125; /// &lt;summary&gt; /// 打印数据定义信息到字符串 /// &lt;/summary&gt; /// &lt;returns&gt;格式化后的定义信息&lt;/returns&gt; public override string ToString() &#123; return $\"Name=&#123;Name&#125;, Unit=&#123;Unit&#125;, Resolution=&#123;Resolution&#125;, Signed=\" + (Signed ? \"true\" : \"false\") + $\", Maximum=&#123;Maximum&#125;, Minimum=&#123;Minimum&#125;\"; &#125; &#125;&#125; 单个json文件对应的class定义123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596using Newtonsoft.Json;using System.Collections.Generic;using System.IO;using System.Linq;using System.Text;/* | 个人微信：InnerGeeker | 联系邮箱：LoongEgg@163.com | 创建时间：2020/6/12 20:41:39 | 主要用途：从json文件读取数据包协议 | 更改记录： | 时间 版本 更改 */namespace LoongEgg.UdpCore&#123; /// &lt;summary&gt; /// 数据包，可以直接从json文件反序列化 /// &lt;/summary&gt; public class JsonPackConfig &#123; /// &lt;summary&gt; /// 当前包的名字 /// &lt;/summary&gt; public string PackName &#123; get; set; &#125; = \"[Undefined]\"; /// &lt;summary&gt; /// 当前包的ID号, 注意为单字节无符号数 /// &lt;/summary&gt; public byte PackID &#123; get; set; &#125; /// &lt;summary&gt; /// 包的字节总长度, 注意最大长度为255 /// &lt;/summary&gt; public byte Length &#123; get &#123; int count = 0; if (Items.Any()) &#123; Items.ForEach(i =&gt; count += i.Length); return (byte)count; &#125; return 0; &#125; &#125; /// &lt;summary&gt; /// 数据对象定义的集合 /// &lt;/summary&gt; public List&lt;ItemConfig&gt; Items &#123; get; set; &#125; /// &lt;summary&gt; /// 从指定的文件反序列化数据包的定义 /// &lt;/summary&gt; /// &lt;param name=\"path\"&gt;文件路径&lt;/param&gt; /// &lt;returns&gt;反序列化后的数据包&lt;/returns&gt; public static JsonPackConfig DeserializeFromFile(string path) &#123; using (StreamReader reader = File.OpenText(path)) &#123; JsonSerializer serializer = JsonSerializer.Create(); var pack = serializer.Deserialize(reader, typeof(JsonPackConfig)) as JsonPackConfig; return pack; &#125; &#125; /// &lt;summary&gt; /// 将协议转换为json字符串形式 /// &lt;/summary&gt; /// &lt;returns&gt;&lt;/returns&gt; public string SerializeToJsonString() =&gt; JsonConvert.SerializeObject(this, Formatting.Indented); /// &lt;summary&gt; /// 将所有的数据协议项转换为一个字符串 /// &lt;/summary&gt; public override string ToString() &#123; StringBuilder builder = new StringBuilder(); builder.AppendLine($\"PackName=&#123;PackName&#125;, PackID=&#123;PackID&#125;:\"); if (Items.Any()) &#123; Items.ForEach( i =&gt; &#123; builder.AppendLine(i.ToString()); &#125;); return builder.ToString(); &#125; return \"JsonPackDefinition is undefined\"; &#125; &#125;&#125; 运用实例123456789101112131415161718192021222324252627using System;using System.Diagnostics;namespace LoongEgg.UdpCore.JsonDemo&#123; class Program &#123; static void Main(string[] args) &#123; try &#123; JsonPackConfig pack = JsonPackConfig.DeserializeFromFile(\"AltPack.json\"); Console.WriteLine(\"Desializing...\"); Console.WriteLine(pack.ToString()); Console.WriteLine(\"Serializing...\"); Console.WriteLine(pack.SerializeToJsonString()); &#125; catch (Exception ex) &#123; Console.WriteLine(ex.Message); &#125; Debugger.Break(); &#125; &#125;&#125;","categories":[{"name":"C#/UDP","slug":"C-UDP","permalink":"https://loongegg.github.io/categories/C-UDP/"}],"tags":[{"name":"C#","slug":"C","permalink":"https://loongegg.github.io/tags/C/"},{"name":"UDP","slug":"UDP","permalink":"https://loongegg.github.io/tags/UDP/"},{"name":"json","slug":"json","permalink":"https://loongegg.github.io/tags/json/"}]},{"title":"C#/Udp-2.收发通信客户端的创建","slug":"C-Udp-2-收发通信客户端的创建","date":"2020-06-13T05:36:23.000Z","updated":"2020-06-13T11:29:48.229Z","comments":true,"path":"2020/06/13/C-Udp-2-收发通信客户端的创建/","link":"","permalink":"https://loongegg.github.io/2020/06/13/C-Udp-2-%E6%94%B6%E5%8F%91%E9%80%9A%E4%BF%A1%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E5%88%9B%E5%BB%BA/","excerpt":"","text":"摘要基本UDP收发通信客户端的创建前言1.系列主题本系列文章，旨在实现使用Json进行配置的Udp收发器 An Udp Sender &amp; Receiver using json file to configure 2.目标框架(target framework) .net framework 4.5 to support using in windows with .net framework &gt;= 4.5 .net standard 2.0 to support using in linux with .net core &gt;= 2.0 3.项目依赖（Dependency） LoongEgg.LoongLog an OpenSource cross-platform &amp; cross-framework log tool, you can get it from nuget or my github Newtonsoft.Json 4.项目地址(Source code) github 5.发行版获取 Search in nuget: LoongEgg.UdpCore 发送端Program.cs1234567891011121314151617181920212223using LoongEgg.LoongLog;using System;namespace UdpSender.Net45&#123; class Program &#123; static void Main(string[] args) &#123; Console.WriteLine(\"Hello World!\"); Logger.Enable(Loggers.ConsoleLogger | Loggers.DebugLogger); var sender = new LoongEgg.UdpCore.UdpSender(2233, true); bool stop = false; do &#123; Console.WriteLine(\"Enter a message or stop/s to exit\"); string input = Console.ReadLine(); stop = input.ToLower() == \"stop\" | input.ToLower() == \"s\"; sender.SendAsync($\"&#123;input&#125;\"); &#125; while (!stop); &#125; &#125;&#125; 接收端12345678910111213141516171819using LoongEgg.LoongLog;using System;namespace UdpReceiver.Net45&#123; class Program &#123; static void Main(string[] args) &#123; Console.WriteLine(\"Hello World!\"); Logger.Enable(Loggers.ConsoleLogger | Loggers.DebugLogger); var receiver = new LoongEgg.UdpCore.UdpReceiver(2233); receiver.ReaderAsync().Wait(); Console.WriteLine(\"Good bye~\"); &#125; &#125;&#125;","categories":[{"name":"C#/UDP","slug":"C-UDP","permalink":"https://loongegg.github.io/categories/C-UDP/"}],"tags":[{"name":"C#","slug":"C","permalink":"https://loongegg.github.io/tags/C/"},{"name":"UDP","slug":"UDP","permalink":"https://loongegg.github.io/tags/UDP/"}]},{"title":"C#/Udp-1.收发通信基础库的实现","slug":"C-Udp-1-收发通信基础库的实现","date":"2020-06-13T02:29:08.000Z","updated":"2020-06-13T11:29:50.062Z","comments":true,"path":"2020/06/13/C-Udp-1-收发通信基础库的实现/","link":"","permalink":"https://loongegg.github.io/2020/06/13/C-Udp-1-%E6%94%B6%E5%8F%91%E9%80%9A%E4%BF%A1%E5%9F%BA%E7%A1%80%E5%BA%93%E7%9A%84%E5%AE%9E%E7%8E%B0/","excerpt":"","text":"摘要基本UDP收发通信基础库的实现前言1.系列主题本系列文章，旨在实现使用Json进行配置的Udp收发器 An Udp Sender &amp; Receiver using json file to configure 2.目标框架(target framework) .net framework 4.5 to support using in windows with .net framework &gt;= 4.5 .net standard 2.0 to support using in linux with .net core &gt;= 2.0 3.项目依赖（Dependency） LoongEgg.LoongLog an OpenSource cross-platform &amp; cross-framework log tool, you can get it from nuget or my github Newtonsoft.Json 4.项目地址(Source code) github 5.发行版获取 Search in nuget: LoongEgg.UdpCore UdpSender.cs1.Properties123456789/// &lt;summary&gt;/// IP端口/// &lt;/summary&gt;public IPEndPoint EndPoint &#123; get; private set; &#125;/// &lt;summary&gt;/// 组地址/// &lt;/summary&gt;public string GroupAddress &#123; get; private set; &#125; 2.Constructors12345678910111213141516171819202122232425/// &lt;summary&gt;/// Udp发送器的构造器/// &lt;/summary&gt;/// &lt;param name=\"port\"&gt;端口号&lt;/param&gt;/// &lt;param name=\"isBroadcast\"&gt;组播?&lt;/param&gt; /// &lt;param name=\"groupAddress\"&gt;组地址&lt;/param&gt;/// &lt;param name=\"isIpV6\"&gt;IpV6模式?&lt;/param&gt;public UdpSender( int port, bool isBroadcast, string groupAddress = null, bool isIpV6 = false)&#123; GroupAddress = groupAddress; string hostName = Dns.GetHostName(); EndPoint = GetIPEndPoint(port, isBroadcast, hostName, groupAddress, isIpV6).Result; GroupAddress = groupAddress; string hostName = Dns.GetHostName(); EndPoint = GetIPEndPoint(port, isBroadcast, hostName, groupAddress, isIpV6).Result; Debug.WriteLine( $\"IPEndPoint: \" + $\"&#123;nameof(port)&#125;=&#123;port&#125;, i&#123;nameof(isBroadcast)&#125;=&#123;isBroadcast&#125;, \" + $\"&#123;nameof(hostName)&#125;=&#123;hostName&#125;, &#123;nameof(groupAddress)&#125;=&#123;groupAddress&#125;, \" + $\"&#123;nameof(isIpV6)&#125;=&#123;isIpV6&#125;\");&#125; 3.Public Methods12345678910111213141516171819202122232425262728293031/// &lt;summary&gt;/// 发送信息/// &lt;/summary&gt;/// &lt;param name=\"message\"&gt;待发送的信息&lt;/param&gt;/// &lt;returns&gt;&lt;/returns&gt;public async void SendAsync(string message)&#123; try &#123; string localhost = Dns.GetHostName(); using (var client = new UdpClient()) &#123; if (GroupAddress != null) &#123; client.JoinMulticastGroup(IPAddress.Parse(GroupAddress)); &#125; byte[] datagram = Encoding.UTF8.GetBytes(message); await client.SendAsync(datagram, datagram.Length, EndPoint); if (GroupAddress != null) &#123; client.DropMulticastGroup(IPAddress.Parse(GroupAddress)); &#125; &#125; &#125; catch (Exception ex) &#123; throw ex; &#125;&#125; 4. Private Methods123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/// &lt;summary&gt;/// 获取指定的IP端口/// &lt;/summary&gt;/// &lt;param name=\"port\"&gt;端口号&lt;/param&gt;/// &lt;param name=\"isBroadcast\"&gt;组播?&lt;/param&gt;/// &lt;param name=\"hostName\"&gt;主机名称&lt;/param&gt;/// &lt;param name=\"groupAddress\"&gt;组地址&lt;/param&gt;/// &lt;param name=\"isIpV6\"&gt;IpV6模式?&lt;/param&gt;/// &lt;returns&gt;&lt;/returns&gt;private static async Task&lt;IPEndPoint&gt; GetIPEndPoint( int port, bool isBroadcast, string hostName, string groupAddress, bool isIpV6)&#123; IPEndPoint endpoint; try &#123; if (isBroadcast) &#123; endpoint = new IPEndPoint(IPAddress.Broadcast, port); Logger.Debug($\"&#123;nameof(isBroadcast)&#125;=&#123;isBroadcast&#125;, &#123;nameof(port)&#125;=&#123;port&#125; \"); &#125; else if (hostName != null) &#123; IPHostEntry hostEntry = await Dns.GetHostEntryAsync(hostName); IPAddress address; if (isIpV6) &#123; address = hostEntry.AddressList.Where( a =&gt; a.AddressFamily == AddressFamily.InterNetworkV6 ).FirstOrDefault(); &#125; else &#123; address = hostEntry.AddressList.Where( a =&gt; a.AddressFamily == AddressFamily.InterNetwork ).FirstOrDefault(); &#125; endpoint = new IPEndPoint(address, port); Logger.Debug($\"&#123;nameof(hostName)&#125;=&#123;hostName&#125;, &#123;nameof(address)&#125;=&#123;address&#125;, &#123;nameof(isIpV6)&#125;=&#123;isIpV6&#125;\"); &#125; else if (groupAddress != null) &#123; endpoint = new IPEndPoint(IPAddress.Parse(groupAddress), port); Logger.Debug($\"&#123;nameof(groupAddress)&#125;=&#123;groupAddress&#125;, &#123;nameof(port)&#125;=&#123;port&#125; \"); &#125; else &#123; throw new InvalidOperationException($\"&#123;nameof(hostName)&#125;, &#123;nameof(isBroadcast)&#125;, or &#123;nameof(groupAddress)&#125; must be set\"); &#125; &#125; catch (Exception ex) &#123; throw ex; &#125; return endpoint;&#125; UdpReceiver.cs1.Properties123456789/// &lt;summary&gt;/// 端口号/// &lt;/summary&gt;public int Port &#123; get; private set; &#125;/// &lt;summary&gt;/// 组地址/// &lt;/summary&gt;public string GroupAddress &#123; get; private set; &#125; 2.Constructors1234567891011/// &lt;summary&gt;/// 创建一个新的接收器/// &lt;/summary&gt;/// &lt;param name=\"port\"&gt;端口号&lt;/param&gt;/// &lt;param name=\"groupAddress\"&gt;组地址&lt;/param&gt;public UdpReceiver(int port, string groupAddress = null)&#123; GroupAddress = groupAddress; Port = port; Logger.Info($\"Listening to &#123;nameof(Port)&#125;=&#123;Port&#125;, &#123;nameof(GroupAddress)&#125;=&#123;GroupAddress&#125;\");&#125; 3.Public Methods1234567891011121314151617181920212223242526272829303132/// &lt;summary&gt;/// 接收器工作/// &lt;/summary&gt; /// &lt;returns&gt;&lt;/returns&gt;public async Task ReaderAsync()&#123; using (var client = new UdpClient(Port)) &#123; if (GroupAddress != null) &#123; Logger.Debug($\"JoinMulticastGroup = &#123;GroupAddress&#125;\"); client.JoinMulticastGroup(IPAddress.Parse(GroupAddress)); &#125; bool completed = false; do &#123; Logger.Debug(\"Listening...\"); UdpReceiveResult result = await client.ReceiveAsync(); byte[] datagram = result.Buffer; ; string received = Encoding.UTF8.GetString(datagram); Logger.Info($\"Received (from &#123;result.RemoteEndPoint.Address.ToString()&#125;)-&gt; &#123;received&#125;\"); completed = (received == \"closed\"); &#125; while (!completed); Logger.Debug(\"Receiver closing\"); if (GroupAddress != null) &#123; client.DropMulticastGroup(IPAddress.Parse(GroupAddress)); &#125; &#125;&#125;","categories":[{"name":"C#/UDP","slug":"C-UDP","permalink":"https://loongegg.github.io/categories/C-UDP/"}],"tags":[{"name":"C#","slug":"C","permalink":"https://loongegg.github.io/tags/C/"},{"name":"UDP","slug":"UDP","permalink":"https://loongegg.github.io/tags/UDP/"}]}],"categories":[{"name":"C#/UDP","slug":"C-UDP","permalink":"https://loongegg.github.io/categories/C-UDP/"}],"tags":[{"name":"C#","slug":"C","permalink":"https://loongegg.github.io/tags/C/"},{"name":"json","slug":"json","permalink":"https://loongegg.github.io/tags/json/"},{"name":"MVVM","slug":"MVVM","permalink":"https://loongegg.github.io/tags/MVVM/"},{"name":"WPF","slug":"WPF","permalink":"https://loongegg.github.io/tags/WPF/"},{"name":"UDP","slug":"UDP","permalink":"https://loongegg.github.io/tags/UDP/"}]}